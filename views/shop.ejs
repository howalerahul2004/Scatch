<%- include('./partials/header') %>

<div class="w-full min-h-screen flex items-start px-20 py-20">
    <div style="width: 25%;" class="flex flex-col items-start">
        <div class="flex items-center gap-2 mb-8">
            <h3 class="font-semibold">Search</h3>
        </div>
        <form action="/shop" class="w-full mb-8">
            <input type="text" name="search" placeholder="Search products..." class="w-full border px-3 py-2 rounded" value="<%= search %>">
            <button type="submit" class="w-full mt-2 px-3 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 transition">Search</button>
            <% if(search) { %>
                <a href="/shop" class="block w-full mt-2 px-3 py-2 bg-gray-400 text-white rounded hover:bg-gray-500 transition text-center">Clear</a>
            <% } %>
        </form>

        <div class="flex items-center gap-2 mb-8">
            <h3 class="font-semibold">Sort by</h3>
            <form action="/shop" class="inline-block" method="GET">
                <select class="border px-3 py-1 rounded" name="sortby" onchange="this.form.submit()">
                    <option value="popular" <% if(sortby === 'popular') { %>selected<% } %>>Popular</option>
                    <option value="newest" <% if(sortby === 'newest') { %>selected<% } %>>Newest</option>
                    <option value="price-low" <% if(sortby === 'price-low') { %>selected<% } %>>Price: Low to High</option>
                    <option value="price-high" <% if(sortby === 'price-high') { %>selected<% } %>>Price: High to Low</option>
                </select>
                <input type="hidden" name="search" value="<%= search %>">
            </form>
        </div>

        <div class="flex flex-col mb-10">
            <h4 class="font-semibold mb-4">Collections</h4>
            <form action="/shop" method="GET">
                <input type="hidden" name="search" value="<%= search %>">
                <input type="hidden" name="sortby" value="<%= sortby %>">
                <input type="hidden" name="filter" value="<%= filterType %>">
                <input type="hidden" name="collection" value="new">
                <button type="submit" class="block mb-2 w-full text-left <% if(collection === 'new') { %>text-black font-semibold<% } else { %>text-gray-600 hover:text-black<% } %> transition">New Collection</button>
            </form>
            <form action="/shop" method="GET">
                <input type="hidden" name="search" value="<%= search %>">
                <input type="hidden" name="sortby" value="<%= sortby %>">
                <input type="hidden" name="filter" value="<%= filterType %>">
                <input type="hidden" name="collection" value="">
                <button type="submit" class="block mb-2 w-full text-left <% if(collection === '' || collection === 'all') { %>text-black font-semibold<% } else { %>text-gray-600 hover:text-black<% } %> transition">All Products</button>
            </form>
            <form action="/shop" method="GET">
                <input type="hidden" name="search" value="<%= search %>">
                <input type="hidden" name="sortby" value="<%= sortby %>">
                <input type="hidden" name="filter" value="<%= filterType %>">
                <input type="hidden" name="collection" value="discounted">
                <button type="submit" class="block mb-2 w-full text-left <% if(collection === 'discounted') { %>text-black font-semibold<% } else { %>text-gray-600 hover:text-black<% } %> transition">Discounted Products</button>
            </form>
        </div>

        <div>
            <h4 class="font-semibold mb-4">Filter by :</h4>
            <form action="/shop" method="GET">
                <input type="hidden" name="search" value="<%= search %>">
                <input type="hidden" name="sortby" value="<%= sortby %>">
                <input type="hidden" name="collection" value="<%= collection %>">
                <input type="hidden" name="filter" value="availability">
                <button type="submit" class="block mb-2 w-full text-left <% if(filterType === 'availability') { %>text-black font-semibold<% } else { %>text-gray-600 hover:text-black<% } %> transition">Availability</button>
            </form>
            <form action="/shop" method="GET">
                <input type="hidden" name="search" value="<%= search %>">
                <input type="hidden" name="sortby" value="<%= sortby %>">
                <input type="hidden" name="collection" value="<%= collection %>">
                <input type="hidden" name="filter" value="discount">
                <button type="submit" class="block mb-2 w-full text-left <% if(filterType === 'discount') { %>text-black font-semibold<% } else { %>text-gray-600 hover:text-black<% } %> transition">Discount</button>
            </form>
        </div>
    </div>

    <div style="width: 75%;" class="flex flex-wrap gap-6">
        <% if(products && products.length > 0) { %>
            <% products.forEach(function(product) { %>
                <div class="border rounded-lg overflow-hidden hover:shadow-lg transition" style="width: 240px;">
                    <div class="flex justify-center items-center" style="width: 100%; height: 208px; background-color: <%= product.bgcolor %>;">
                        <% if(product.image) { %>
                            <% if(typeof product.image === 'string') { %>
                                <img class="h-40 object-contain" src="<%= product.image %>" alt="<%= product.name %>">
                            <% } else { %>
                                <img class="h-40 object-contain" src="data:image/jpeg;base64,<%= product.image.toString('base64') %>" alt="<%= product.name %>">
                            <% } %>
                        <% } else { %>
                            <div class="text-gray-400">No Image</div>
                        <% } %>
                    </div>
                    <div class="flex justify-between items-center px-4 py-4" style="background-color: <%= product.panecolor %>; color: <%= product.textcolor %>;">
                        <div>
                            <h3 class="font-semibold"><%= product.name %></h3>
                            <div class="flex items-center gap-2 mt-1">
                                <span class="line-through text-gray-500 text-sm">₹<%= product.price %></span>
                                <span class="font-bold">₹<%= product.price - product.discount %></span>
                            </div>
                        </div>
                        <div class="flex gap-1">
                            <a class="flex items-center justify-center rounded-full hover:scale-110 transition" 
                               href="/addtocart/<%= product._id %>"
                               style="width: 32px; height: 32px; background-color: <%= product.panecolor %>; color: <%= product.textcolor %>;"
                               title="Add to Cart">
                                <i class="ri-shopping-cart-2-line"></i>
                            </a>
                            <a class="flex items-center justify-center rounded-full hover:scale-110 transition" 
                               href="/addtowishlist/<%= product._id %>"
                               style="width: 32px; height: 32px; background-color: <%= product.panecolor %>; color: <%= product.textcolor %>;"
                               title="Add to Wishlist">
                                <i class="ri-heart-line"></i>
                            </a>
                        </div>
                    </div>
                </div>
            <% }); %>
        <% } else { %>
            <div class="w-full text-center py-20">
                <% if(search) { %>
                    <p class="text-gray-500 text-lg">No products found for "<%= search %>"</p>
                    <a href="/shop" class="mt-4 inline-block px-6 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 transition">View All Products</a>
                <% } else { %>
                    <p class="text-gray-500 text-lg">No products available</p>
                <% } %>
            </div>
        <% } %>
    </div>
</div>

<%- include('./partials/footer') %>
