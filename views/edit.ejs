<%- include('./partials/header') %>

<% if(typeof success !== 'undefined' && success.length > 0){ %>
    <div class="absolute top-5 left-1/2 -translate-x-1/2 -translate-y-1/2 p-3 rounded-md bg-blue-500 z-50">
        <span class="inline-block mt-1 mb-1 text-white">
            <%= success %>
        </span>
    </div>
<% } %>

<div class="min-h-screen flex flex-col">
    <div class="container px-10 py-20 flex flex-grow">
        <div class="w-[25%] flex flex-col items-start">
            <div class="flex flex-col space-y-3">
                <h3 class="font-semibold text-lg">Admin Menu</h3>
                <a class="block w-fit text-blue-500 hover:underline" href="/products">All Products</a>
                <a class="block w-fit text-blue-500 hover:underline" href="/owners/admin">Create Product</a>
            </div>
        </div>
        <main class="w-3/4 bg-white p-8 shadow ml-4 rounded-lg">
            <h2 class="text-2xl font-bold mb-6">Edit Product</h2>
            <form action="/products/edit/<%= product._id %>" method="post" enctype="multipart/form-data">
                <div class="mb-8">
                    <h3 class="text-lg font-semibold mb-4 border-b pb-2">Product Details</h3>
                    
                    <div class="mb-6">
                        <label class="block mb-3 font-medium text-gray-700">Product Image</label>
                        <div class="space-y-4">
                            <div>
                                <label class="inline-flex items-center mb-3">
                                    <input type="radio" name="imageSource" value="keep" checked class="form-radio">
                                    <span class="ml-2 font-medium">Keep Current Image</span>
                                </label>
                                <div class="mt-2 p-4 border rounded bg-gray-50">
                                    <% if(typeof product.image === 'string') { %>
                                        <img class="h-32 object-contain" src="<%= product.image %>" alt="<%= product.name %>">
                                    <% } else { %>
                                        <img class="h-32 object-contain" src="data:image/jpeg;base64,<%= product.image.toString('base64') %>" alt="<%= product.name %>">
                                    <% } %>
                                </div>
                            </div>
                            
                            <div class="border-t pt-4">
                                <label class="inline-flex items-center mb-3">
                                    <input type="radio" name="imageSource" value="upload" class="form-radio">
                                    <span class="ml-2 font-medium">Upload New Image File</span>
                                </label>
                                <input type="file" name="image" id="fileUpload" class="block w-full px-4 py-2 border rounded border-gray-300 focus:outline-none focus:border-blue-500" accept="image/*" disabled>
                                <p class="text-sm text-gray-500 mt-1">Supported formats: JPG, PNG, GIF, WebP (Max 5MB)</p>
                            </div>

                            <div class="border-t pt-4">
                                <label class="inline-flex items-center mb-3">
                                    <input type="radio" name="imageSource" value="url" class="form-radio">
                                    <span class="ml-2 font-medium">Use Image URL</span>
                                </label>
                                <input type="url" name="imageUrl" id="urlInput" placeholder="https://example.com/image.jpg" class="block w-full px-4 py-2 border rounded border-gray-300 focus:outline-none focus:border-blue-500" disabled>
                                <p class="text-sm text-gray-500 mt-1">Enter a direct URL to an image hosted online</p>
                            </div>
                        </div>
                    </div>
                    
                    <script>
                        const keepRadio = document.querySelector('input[value="keep"]');
                        const uploadRadio = document.querySelector('input[value="upload"]');
                        const urlRadio = document.querySelector('input[value="url"]');
                        const fileUpload = document.getElementById('fileUpload');
                        const urlInput = document.getElementById('urlInput');
                        const form = document.querySelector('form');
                        
                        function updateFormState() {
                            if(keepRadio.checked) {
                                fileUpload.disabled = true;
                                urlInput.disabled = true;
                                fileUpload.required = false;
                                urlInput.required = false;
                            } else if(uploadRadio.checked) {
                                fileUpload.disabled = false;
                                urlInput.disabled = true;
                                fileUpload.required = true;
                                urlInput.required = false;
                                urlInput.value = '';
                            } else {
                                fileUpload.disabled = true;
                                urlInput.disabled = false;
                                fileUpload.required = false;
                                urlInput.required = true;
                            }
                        }
                        
                        keepRadio.addEventListener('change', updateFormState);
                        uploadRadio.addEventListener('change', updateFormState);
                        urlRadio.addEventListener('change', updateFormState);
                        
                        form.addEventListener('submit', function(e) {
                            if(uploadRadio.checked && !fileUpload.files.length) {
                                e.preventDefault();
                                alert('Please select an image file');
                                return false;
                            }
                            if(urlRadio.checked && !urlInput.value.trim()) {
                                e.preventDefault();
                                alert('Please enter an image URL');
                                return false;
                            }
                        });
                        
                        updateFormState();
                    </script>

                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block mb-2 font-medium text-gray-700">Product Name</label>
                            <input type="text" name="name" placeholder="Enter product name" class="border p-3 rounded w-full focus:outline-none focus:border-blue-500" value="<%= product.name %>" required>
                        </div>
                        <div>
                            <label class="block mb-2 font-medium text-gray-700">Product Price</label>
                            <input type="number" name="price" placeholder="Enter price" class="border p-3 rounded w-full focus:outline-none focus:border-blue-500" value="<%= product.price %>" required>
                        </div>
                        <div>
                            <label class="block mb-2 font-medium text-gray-700">Discount</label>
                            <input type="number" name="discount" placeholder="Enter discount" class="border p-3 rounded w-full focus:outline-none focus:border-blue-500" value="<%= product.discount %>">
                        </div>
                    </div>
                </div>

                <div class="mb-8">
                    <h3 class="text-lg font-semibold mb-4 border-b pb-2">Design Details</h3>
                    <div class="grid grid-cols-3 gap-4">
                        <div>
                            <label class="block mb-2 font-medium text-gray-700">Background Color</label>
                            <input type="color" name="bgcolor" class="w-full h-12 border rounded cursor-pointer" value="<%= product.bgcolor %>">
                        </div>
                        <div>
                            <label class="block mb-2 font-medium text-gray-700">Panel Color</label>
                            <input type="color" name="panecolor" class="w-full h-12 border rounded cursor-pointer" value="<%= product.panecolor %>">
                        </div>
                        <div>
                            <label class="block mb-2 font-medium text-gray-700">Text Color</label>
                            <input type="color" name="textcolor" class="w-full h-12 border rounded cursor-pointer" value="<%= product.textcolor %>">
                        </div>
                    </div>
                </div>

                <div class="flex gap-4">
                    <button class="flex-1 px-5 py-3 rounded-lg bg-blue-500 text-white font-semibold hover:bg-blue-600 transition" type="submit">
                        Update Product
                    </button>
                    <a href="/products" class="flex-1 px-5 py-3 rounded-lg bg-gray-400 text-white font-semibold hover:bg-gray-500 transition text-center">
                        Cancel
                    </a>
                </div>
            </form>
        </main>
    </div>
</div>

<%- include('./partials/footer') %>
